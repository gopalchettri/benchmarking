def get_criteria_prompt(control: str, subcontrol: str, framework: str) -> str:
    return (
        f'Control: {control}\n'
        f'Subcontrol: {subcontrol}\n\n'
        "Generate exactly three evaluation criteria for compliance assessment. "
        "Each criterion must be testable and actionable. "
        "Return ONLY a JSON array of three objects with this schema:\n\n"
        '[\n'
        '  {\n'
        '    "id": 1,                         # integer\n'
        '    "criterion": "short title",     # short sentence\n'
        '    "description": "one-paragraph detailed requirement",\n'
        '    "design_level": "what to look for at design level (short)",\n'
        '    "implementation_level": "what to look for at implementation level (short)",\n'
        '    "evidence_examples": ["e.g. meeting minutes", "e.g. list of parties"]\n'
        '  },\n'
        '  ... (total 3 objects)\n'
        ']\n\n'
        "Do not include any explanation, headings, markdown, or extra text. "
        "Do not output fewer or more than three objects."
    )

async def get_system_prompt(framework: str) -> str:
    """Production-grade system prompt with clear constraints."""
    return (
        f"You are an expert cybersecurity auditor specializing in {framework} compliance assessments.\n\n"
        f"CRITICAL REQUIREMENTS:\n"
        f"1. Output MUST be valid JSON only - no markdown, no explanations, no preamble\n"
        f"2. Output MUST be a JSON array with exactly 3 objects\n"
        f"3. Each object MUST have 'id' (integer) and 'criteria' (string) fields only\n"
        f"4. Write natural, professional language without escaped characters\n"
        f"5. Keep criteria concise: 40-60 words maximum per criterion\n\n"
        f"If you cannot generate valid JSON, return an empty array: []"
    )
async def get_criteria_prompt(control: str, subcontrol: str, framework: str) -> str:
    """Production-optimized prompt with clear structure and example."""
    return (
        f"Framework: {framework}\n"
        f"Control: {control}\n"
        f"Subcontrol: {subcontrol}\n\n"
        f"Task: Generate exactly 3 evaluation criteria for compliance assessment.\n\n"
        f"Structure for each criterion:\n"
        f"- Brief title (3-5 words)\n"
        f"- Core requirement description (1 sentence)\n"
        f"- Design-level check (1 sentence)\n"
        f"- Implementation-level check (1 sentence)\n\n"
        f"Combine all parts into ONE continuous string without labels.\n\n"
        f"EXAMPLE OUTPUT FORMAT:\n"
        f"[\n"
        f"  {{\n"
        f"    \"id\": 1,\n"
        f"    \"criteria\": \"Access Control Matrix - Define role-based permissions for all system resources. Verify comprehensive permission matrix exists in design documentation. Validate actual permissions match design specifications in production environment.\"\n"
        f"  }},\n"
        f"  {{\n"
        f"    \"id\": 2,\n"
        f"    \"criteria\": \"Authentication Mechanisms - Implement multi-factor authentication for privileged access. Review authentication flow diagrams and security architecture. Test MFA implementation across all access points.\"\n"
        f"  }},\n"
        f"  {{\n"
        f"    \"id\": 3,\n"
        f"    \"criteria\": \"Audit Logging Requirements - Maintain immutable audit logs for security events. Confirm logging strategy covers all security-relevant actions. Verify log integrity, retention, and monitoring capabilities.\"\n"
        f"  }}\n"
        f"]\n\n"
        f"Output ONLY the JSON array above with {framework} {control} {subcontrol} criteria. No additional text."
    )

